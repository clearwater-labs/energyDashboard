<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>
        <script src="https://d3js.org/d3-time.v1.min.js"></script>
        <script src="https://d3js.org/d3-time-format.v2.min.js"></script>
        <style>

            .axis {
              font: 10px sans-serif;
            }
        
            .axis path,
            .axis line {
              fill: none;
              stroke: #000;
              shape-rendering: crispEdges;
            }
        
            </style>
    </head>
    <body>
    


    
    <script type="text/javascript">
       var request = new XMLHttpRequest();
        request.open('GET', "http://localhost:8080/request", true);
        request.onload = () => {
            //console.log(request.responseText);
            //var data = JSON.parse(request.responseText);
            var strictIsoParse = d3.utcParse("%Y-%m-%dT%H:%M:%S.%LZ");
            var data = JSON.parse(request.responseText, function (key, value) {
                if (key == "name") {
                    return strictIsoParse(value);
                } else {
                    return value;
                }
            });
            data.forEach(d => {
                d.value = (+d.value);
            });

            var margin = {top: 20, right: 20, bottom: 200, left: 100},
                width = 1000 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            var x = d3.scaleBand().domain(d3.range(0, data.length)).range([0, width]);
            var y = d3.scaleLinear().domain([500000000, 630000000]).range([0, height]);

            var svg = d3.select("body").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform", 
                    "translate(" + margin.left + "," + margin.top + ")")
                .selectAll('rect').data(data)
                .enter().append('rect')
                .styles({

                })
                .attr('width', x.bandwidth())
                .attr('x', function(data, i) {
                    return x(i);
                })
                .attr('height', function(data) {
                    return y(data.value);
                })
                .attr('y', function(data) {
                    return height - y(data.value);
                });

            var xAxis = d3.axisBottom(x).ticks(10);
            var yAxis = d3.axisLeft(y).ticks(10);

            var verticalGuideScale = d3.scaleLinear()
                .domain([500000000, 630000000])
                .range([height, 0])

            var vAxis = d3.axisLeft(verticalGuideScale)
            .ticks(10)

            var verticalGuide = d3.select('svg').append('g')
            vAxis(verticalGuide)
            verticalGuide.attr('transform', 'translate(' + margin.left + ', ' + margin.top + ')');

            var hAxis = d3.axisBottom(x)
            .ticks(10)

            var horizontalGuide = d3.select('svg').append('g')
            hAxis(horizontalGuide)
            horizontalGuide.attr('transform', 'translate(' + margin.left + ', ' + (height + margin.top) + ')');

            console.log("graph loaded");
        };
        request.onerror = function () {
            console.log(request.responseText);
        };
        request.send();
    </script>
    </body>
</html>